
<!DOCTYPE html>

<html> 

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>lukencode | code first, ask questions later</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/img/favicon.ico">

	<link rel="profile" href="http://gmpg.org/xfn/11" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/responsive.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/prettify.css" type="text/css" media="screen, projection" />
	<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
	
	<!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	
	<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
	
	<script src="/js/prettify.js" type="text/javascript"></script>
	
	<meta name="google-site-verification" content="e6fQUO7vqSIw6sdQQeiUPs4JPc8VghE_9u72V2NXv4U" /> 	
</head>		
	
<body onload="prettyPrint()">
	<div id="header-wrap">
		<header>
			<hgroup>
				<h1>
					<a href="/" title="lukencode" rel="home">lukencode</a>
				</h1>
				<div id="site-description">code first, ask questions later</div>
			</hgroup>			
		</header>
								
		<div id="secondary" class="widget-area">
			<aside id="me" class="widget">
				<div class="info">
					<h4>Author</h4>	
					
					<img class="grav" src='http://en.gravatar.com/userimage/7397984/5de7392594b98c6b510f0691ca5e0638.jpeg' />
					
					<div class="about">
						<strong>Luke Lowrey</strong>
						<p>I drink beer and build web and mobile apps (in that order).</p>
					</div>
				</div>
				<div class="short-info">
					A programming blog by <strong>Luke Lowrey</strong>
				</div>
				<ul>
					<li id="twitter-button"><a href="http://twitter.com/lukencode" class="twitter-follow-button" data-button="grey" data-text-color="#FFFFFF" data-link-color="#00AEFF">Follow @lukencode</a></li>
					<li> <a href='/about'>About</a> </li>					
					<li> <a href='/contact'>Contact</a> </li>
					<li id="twitter-text"><a href="http://twitter.com/lukencode" >@lukencode</a></li>
					<li>
						<a href="/rss.xml">
							<img src='http://lukencode.com/wp-content/uploads/2011/04/feed-icon.png' />
							Subscribe
						</a>
					</li>
				</ul>
			</aside>
		</div>			
	</div>
				
	<div id="primary">
		<div id="content">
			<div id="post">
	<h1> Simple C# Synchronous / Asynchronous Email Sender </h1>
	<div class="date">12, febuary 2011</div>
	
	<article>
		<p><strong>UPDATE:</strong> I am now using a <a href="http://lukencode.com/2010/04/11/fluent-email-in-net/">Fluent Email Class </a> that implements similar techniques.</p>
<p>I noticed quite a few search queries coming in for my post on <a title="c# email templates" href="http://lukencode.com/2010/03/23/user-control-email-templates-in-asp-net/">User Control Email Templates</a> so I thought I should post the code I am using to actually send the emails in that example. The class uses the SMTP configuration information in the web.config or app.config of the application. An example of the config is after the code.</p>
<p>The code is pretty quick and dirty but if you are only sending one off emails it works fine.</p>
<pre class="brush: csharp">    public static class EmailSender
    {
        ///
        /// Sends an Email.
        ///
        public static bool Send(string sender, string senderName, string recipient, string recipientName, string subject, string body)
        {
            var message = new MailMessage()
            {
                From = new MailAddress(sender, senderName),
                Subject = subject,
                Body = body,
                IsBodyHtml = true
            };
            message.To.Add(new MailAddress(recipient, recipientName));

            try
            {
                var client = new SmtpClient();
                client.Send(message);
            }
            catch (Exception ex)
            {
                //handle exeption
                return false;
            }

            return true;
        }

        ///
        /// Sends an Email asynchronously
        ///
        public static void SendAsync(string sender, string senderName, string recipient, string recipientName, string subject, string body)
        {
            var message = new MailMessage()
                {
                    From = new MailAddress(sender, senderName),
                    Subject = subject,
                    Body = body,
                    IsBodyHtml = true
                };
            message.To.Add(new MailAddress(recipient, recipientName));

            var client = new SmtpClient();
            client.SendCompleted += MailDeliveryComplete;
            client.SendAsync(message, message);
        }

        private static void MailDeliveryComplete(object sender, AsyncCompletedEventArgs e)
        {
            if (e.Error != null)
            {
                //handle error
            }
            else if (e.Cancelled)
            {
                //handle cancelled
            }
            else
            {
                //handle sent email
                MailMessage message = (MailMessage)e.UserState;
            }
        }
    }</pre>
<p>Here is an example of the mailSettings config section.</p>
<pre class="brush: xml">
    &lt;system.net&gt;
      &lt;mailSettings&gt;
        &lt;smtp from=&quot;test@test.test&quot;&gt;
          &lt;network host=&quot;smtphost&quot; port=&quot;25&quot; username=&quot;user&quot; password=&quot;password&quot; defaultCredentials=&quot;true&quot; /&gt;
        &lt;/smtp&gt;
      &lt;/mailSettings&gt;
    &lt;/system.net&gt;
</pre>
	</article>
</div>
	
<div id="page-navigation"> 
	<div class="left">  </div> 
	<div class="right">  </div> 
	<div class="clear">&nbsp;</div>
</div> 


<div id="disqus_thread"></div>

<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'lukencode'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
		</div>				

		<footer>
			<small>powered by <a href="https://github.com/code52/pretzel">pretzel</a> / <a href="https://github.com/mojombo/jekyll">jekyll</a> and living on <a href="https://github.com">github</a></small>
		</footer>
	</div>

</body>
</html>

